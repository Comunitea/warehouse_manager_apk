<ion-card *ngIf="picking_data">

  <ion-card-header>
    <ion-row>
      <ion-col>
        <ion-card-title>{{picking_data.name}}</ion-card-title>
        <ion-card-subtitle>{{picking_data.picking_type_id[1]}}</ion-card-subtitle>
      </ion-col>
      <ion-col>
        <ion-item class="ion-text-right">
          <!-- <ion-button *ngIf="picking_data.show_check_availability" size="small" class="button-text" (click)="action_assign()">Asignar</ion-button> -->
          <ion-button *ngIf="picking_data.show_validate" size="small" class="button-text" (click)="button_validate()">Validar</ion-button>
        </ion-item>
      </ion-col>
    </ion-row>
  </ion-card-header>

  <ion-card-content>
    <div><strong>Previsto: </strong>{{picking_data.scheduled_date}}</div>
    <div><strong>Origen: </strong><span class="location" (click)="open_link(picking_data.location_id[0])">{{picking_data.location_id[1]}}</span></div>
    <div><strong>Destino: </strong><span class="location" (click)="open_link(picking_data.location_dest_id[0])">{{picking_data.location_dest_id[1]}}</span></div>
    <div [ngSwitch]="picking_data.priority">
      <strong>Prioridad: </strong>
      <ion-text *ngSwitchCase="0">No Urgente</ion-text>
      <ion-text *ngSwitchCase="1">Normal</ion-text>
      <ion-text *ngSwitchCase="2">Urgente</ion-text>
      <ion-text *ngSwitchCase="3">Muy Urgente</ion-text>
    </div>
    <div *ngIf="picking_data.note"><strong>Nota: </strong>{{picking_data.note}}</div>
  </ion-card-content>

</ion-card>

<div>

  <ion-card *ngIf="move_lines && move_line_ids">
    <ion-card-header>
      <ion-row>
        <ion-col>
          <ion-card-title *ngIf="!active_operation; else detailed_title">Operaciones</ion-card-title>
        </ion-col>
        <!-- <ion-col class="ion-text-right">
          <ion-item>
            <ion-label>Detalles:</ion-label>
            <ion-toggle [(ngModel)]="active_operation" color="primary"></ion-toggle>
          </ion-item>
        </ion-col> -->
      </ion-row>
    </ion-card-header>

    <ng-template #detailed_title>
      <ion-card-title>Operaciones detalladas</ion-card-title>
    </ng-template>

    <ion-card-content *ngIf="move_lines || move_line_ids">
      <app-move-line-list *ngIf="!active_operation && move_lines; else detailed_grid" [code]="picking_code" [move_lines]="move_lines"></app-move-line-list>

      <!-- <ion-grid>          
        <ion-row>
          <ion-col>
            
          </ion-col>
          
          <ion-col size="2">
              <strong>Totales:</strong>
          </ion-col>
        
          <ion-col size="2">
            <div *ngIf="!active_operation; else reserved_lines">{{picking_data.reserved_availability}}</div>
          </ion-col>
      
          <ion-col size="2">
            <div *ngIf="!active_operation; else done_lines">{{picking_data.quantity_done}}</div>
          </ion-col>
        </ion-row>
      </ion-grid> -->

      <ng-template #detailed_grid>
        <app-move-line-details-list *ngIf="move_line_ids" [code]="picking_code" [move_line_ids]="move_line_ids"></app-move-line-details-list>
        <ion-col class="ion-text-right">
          <ion-item>
            <ion-button size="small" *ngIf="picking_data && (picking_data.state == 'confirmed' || picking_data.state == 'assigned')" class="button-text" (click)="force_set_assigned_qty_done(picking_data.id, 'stock.picking')">Reservas a hecho</ion-button>
            <ion-button size="small" *ngIf="picking_data && (picking_data.state == 'confirmed' || picking_data.state == 'assigned')" class="button-text" (click)="force_reset_qties(picking_data.id, 'stock.picking')">Reset</ion-button>
          </ion-item>
        </ion-col>
      </ng-template>

      <!-- <ng-template #reserved_lines>
        <div>{{picking_data.reserved_availability_lines}}</div>
      </ng-template>

      <ng-template #done_lines>
        <div>{{picking_data.quantity_done_lines}}</div>
      </ng-template> -->

    </ion-card-content>
  </ion-card>

</div>